{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","NegociacaoView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","_mensagem","_negociacaoService","_init","lista","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importaNegociacoes","event","preventDefault","_criaNegociacao","cadastra","_limpaFormulario","textoParaData","value","parseInt","parseFloat","focus","apaga","mensagem","esvazia","importa","reduce","arrayTransformado","array","concat","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\nimport {Mensagem} from '../models/Mensagem';\nimport {Negociacao} from '../models/Negociacao';\nimport {NegociacaoView} from '../views/NegociacoesView';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {DateHelper} from '../helpers/DateHelper';\nimport {Bind} from '../helpers/Bind';\n\nexport class NegociacaoController {\n\n    constructor() {\n        let $ = document.querySelector.bind(document);\n        this._inputData = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor = $('#valor');\n\n        this._listaNegociacoes = new Bind(\n            new ListaNegociacoes(),\n            new NegociacaoView($('#negociacoesView')),\n            ['adiciona','esvazia']\n        );\n\n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView( $('#mensagemView') ),\n            ['texto']\n        );\n\n        this._negociacaoService = new NegociacaoService();\n\n        this._init();\n    }\n\n    _init(){\n\n        this._negociacaoService\n        .lista()\n        .then(negociacoes => \n            negociacoes.forEach(negociacao =>\n                this._listaNegociacoes.adiciona(negociacao))\n        ) \n        .catch(erro => this._mensagem.texto = erro);\n\n        setInterval(() => {\n            this.importaNegociacoes();\n        }, 3000);\n    }\n\n    adiciona(event){\n\n        event.preventDefault();\n\n        let negociacao = this._criaNegociacao();\n\n        this._negociacaoService\n            .cadastra(negociacao)\n            .then( mensagem => {\n                this._listaNegociacoes.adiciona(negociacao);\n                this._mensagem.texto = 'Negociação adicionada com sucesso.';\n                this._limpaFormulario();\n            })\n            .catch(erro => this._mensagem.texto = erro); \n    }\n\n    _criaNegociacao(){\n        return new Negociacao(\n            DateHelper.textoParaData(this._inputData.value), \n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value)  \n        );\n    }\n\n    _limpaFormulario(){\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0;\n        this._inputData.focus();\n    }\n\n    apaga(){\n\n        this._negociacaoService\n            .apaga()\n            .then(mensagem => {\n                this._mensagem.texto = mensagem;\n                this._listaNegociacoes.esvazia();\n            })\n            .catch(erro => this._mensagem.texto = erro); \n    }\n\n    importaNegociacoes(){\n        \n        this._negociacaoService\n        .importa(this._listaNegociacoes.negociacoes)\n        .then(\n            negociacoes => {\n                negociacoes\n                    .reduce((arrayTransformado, array) => arrayTransformado.concat(array), [])\n                    .forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\n                this._mensagem.texto = 'Negociações da semana obtidas com sucesso';\n            }\n        ).catch(erro => this._mensagem.texto = erro);\n\n    }\n}\n\nlet negociacaoController = new NegociacaoController();\n\nexport function currentInstance(){\n    return negociacaoController;\n}"]}